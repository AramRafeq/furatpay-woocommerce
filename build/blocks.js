(()=>{"use strict";const e=window.React,t=window.wp.i18n,a=window.wp.element,s="furatpay",r=({services:t,selectedService:a,onSelect:s})=>(0,e.createElement)("ul",{className:"furatpay-method-list"},t.map((t=>(0,e.createElement)("li",{key:t.id,className:"furatpay-method-item"},(0,e.createElement)("label",null,(0,e.createElement)("input",{type:"radio",name:"furatpay_service",value:t.id,checked:a===t.id,onChange:()=>s(t.id),required:"required",className:"furatpay-service-radio"}),t.logo&&(0,e.createElement)("img",{src:t.logo,alt:t.name,className:"furatpay-method-logo"}),(0,e.createElement)("span",{className:"furatpay-method-name"},t.name)))))),o=({eventRegistration:s,emitResponse:o,extensions:n})=>{const[c,i]=(0,a.useState)(null),[l,y]=(0,a.useState)([]),{onPaymentSetup:u}=s;return(0,a.useEffect)((()=>{let e=!0;return(async()=>{try{const t=await fetch(furatpayData.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"furatpay_get_payment_services",nonce:furatpayData.nonce})});if(!t.ok)throw new Error("Failed to fetch payment services");const a=await t.json();if(e&&a.success&&Array.isArray(a.data)&&(y(a.data),a.data.length>0&&!c)){const e=a.data[0].id,t=a.data[0].name;i(e);try{sessionStorage.setItem("furatpay_service_id",e.toString()),sessionStorage.setItem("furatpay_service_name",t),console.log("FuratPay: Auto-selected first service:",t)}catch(e){console.error("FuratPay: Error storing auto-selected service:",e)}}}catch(e){console.error("FuratPay: Error fetching payment services:",e)}})(),()=>{e=!1}}),[]),(0,a.useEffect)((()=>{const e=u((()=>{if(console.log("FuratPay: Payment setup callback triggered"),console.log("FuratPay: Selected service:",c),console.log("FuratPay: Available services:",l.length),!c)return console.error("FuratPay: No service selected, returning error"),{type:o.responseTypes.ERROR,message:(0,t.__)("Please select a payment service.","woo_furatpay")};const e=l.find((e=>e.id===c));if(!e)return console.error("FuratPay: Service not found"),{type:o.responseTypes.ERROR,message:(0,t.__)("Invalid payment service selected.","woo_furatpay")};const a=[{key:"furatpay_service",value:c.toString()},{key:"furatpay_service_name",value:e.name}];return console.log("FuratPay: Returning SUCCESS with data:",a),{type:o.responseTypes.SUCCESS,meta:{paymentMethodData:a},paymentMethodData:a}}));return()=>e()}),[u,c,l,o.responseTypes]),0===l.length?(0,e.createElement)("div",{className:"furatpay-payment-method-block"},(0,e.createElement)("p",null,(0,t.__)("No payment services available.","woo_furatpay"))):(0,e.createElement)("div",{className:"furatpay-payment-method-block"},(0,e.createElement)(r,{services:l,selectedService:c,onSelect:e=>{i(e);const t=l.find((t=>t.id===e));if(t)try{sessionStorage.setItem("furatpay_service_id",e.toString()),sessionStorage.setItem("furatpay_service_name",t.name),console.log("FuratPay: Stored service in sessionStorage:",{service_id:e,service_name:t.name})}catch(e){console.error("FuratPay: Error storing in sessionStorage:",e)}}}))},n={name:s,label:(0,e.createElement)((()=>(0,e.createElement)("div",{className:"furatpay-block-label"},(0,e.createElement)("span",null,furatpayData.title),furatpayData.icon&&(0,e.createElement)("img",{src:furatpayData.icon,alt:"FuratPay",className:"furatpay-icon"}))),null),content:(0,e.createElement)(o,null),edit:(0,e.createElement)(o,null),canMakePayment:()=>(console.log("FuratPay: canMakePayment called"),!0),ariaLabel:(0,t.__)("FuratPay payment method","woo_furatpay"),supports:{features:furatpayData.supports||["products"],showSavedPaymentMethods:!1,showSaveOption:!1}},{registerPaymentMethod:c}=wc.wcBlocksRegistry;console.log("FuratPay: Registering payment method with options:",n),c(n),console.log("FuratPay: Payment method registered successfully"),function(){const e=window.fetch;window.fetch=function(...t){const[a,s]=t;if(a&&"string"==typeof a&&a.includes("/wc/store/v1/checkout")){console.log("FuratPay: Intercepted checkout request");const e=sessionStorage.getItem("furatpay_service_id"),t=sessionStorage.getItem("furatpay_service_name");if(e&&s&&s.body)try{const a=JSON.parse(s.body);a.extensions||(a.extensions={}),a.extensions.furatpay={furatpay_service:e,furatpay_service_name:t||""},s.body=JSON.stringify(a),console.log("FuratPay: Injected extension data into request:",a.extensions.furatpay)}catch(e){console.error("FuratPay: Error modifying request:",e)}else console.log("FuratPay: No service data found in sessionStorage")}return e.apply(this,t)},console.log("FuratPay: Fetch interceptor installed")}(),"undefined"!=typeof wp&&wp.data&&wp.data.select&&wp.domReady((()=>{console.log("FuratPay: Attempting to auto-select payment method");try{const e=wp.data.select("wc/store/checkout");if(e){const t=e.getAvailablePaymentMethods();if(console.log("FuratPay: Available payment methods:",t),t&&t.includes(s)){const e=wp.data.dispatch("wc/store/payment");e&&e.setActivePaymentMethod&&(e.setActivePaymentMethod(s),console.log("FuratPay: Successfully set as active payment method"))}}}catch(e){console.log("FuratPay: Could not auto-select:",e.message)}}))})();