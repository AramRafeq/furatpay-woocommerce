(()=>{"use strict";const e=window.React,t=window.wp.i18n,a=window.wp.element,r="furatpay",s=({services:t,selectedService:a,onSelect:r})=>(0,e.createElement)("ul",{className:"furatpay-method-list"},t.map((t=>(0,e.createElement)("li",{key:t.id,className:"furatpay-method-item"},(0,e.createElement)("label",null,(0,e.createElement)("input",{type:"radio",name:"furatpay_service",value:t.id,checked:a===t.id,onChange:()=>r(t.id),required:"required",className:"furatpay-service-radio"}),t.logo&&(0,e.createElement)("img",{src:t.logo,alt:t.name,className:"furatpay-method-logo"}),(0,e.createElement)("span",{className:"furatpay-method-name"},t.name)))))),n=({eventRegistration:r,emitResponse:n,extensions:o})=>{const[c,i]=(0,a.useState)(null),[l,p]=(0,a.useState)([]),[y,m]=(0,a.useState)(!0),[u,d]=(0,a.useState)(null),{onPaymentSetup:f}=r;return(0,a.useEffect)((()=>{let e=!0;return(async()=>{try{if(m(!0),d(null),!furatpayData||!furatpayData.ajaxUrl)throw new Error("FuratPay configuration not found");const t=await fetch(furatpayData.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"furatpay_get_payment_services",nonce:furatpayData.nonce})});if(!t.ok)throw new Error("Failed to fetch payment services (HTTP "+t.status+")");const a=await t.json();if(!e)return;if(!a.success||!Array.isArray(a.data)){const e=a.data&&a.data.message||"No payment services returned";throw new Error(e)}if(p(a.data),a.data.length>0&&!c){const e=a.data[0].id,t=a.data[0].name;i(e);try{sessionStorage.setItem("furatpay_service_id",e.toString()),sessionStorage.setItem("furatpay_service_name",t)}catch(e){}}}catch(t){e&&(console.error("FuratPay: Error loading payment services:",t),d(t.message))}finally{e&&m(!1)}})(),()=>{e=!1}}),[]),(0,a.useEffect)((()=>{const e=f((()=>{if(!c)return{type:n.responseTypes.ERROR,message:(0,t.__)("Please select a payment service.","woo_furatpay")};const e=l.find((e=>e.id===c));if(!e)return{type:n.responseTypes.ERROR,message:(0,t.__)("Invalid payment service selected.","woo_furatpay")};const a=[{key:"furatpay_service",value:c.toString()},{key:"furatpay_service_name",value:e.name}];return{type:n.responseTypes.SUCCESS,meta:{paymentMethodData:a},paymentMethodData:a}}));return()=>e()}),[f,c,l,n.responseTypes]),y?(0,e.createElement)("div",{className:"furatpay-payment-method-block"},(0,e.createElement)("p",null,(0,t.__)("Loading payment services...","woo_furatpay"))):u?(0,e.createElement)("div",{className:"furatpay-payment-method-block"},(0,e.createElement)("p",{style:{color:"#dc3232"}},(0,t.__)("Error loading payment services. Please refresh the page.","woo_furatpay"))):0===l.length?(0,e.createElement)("div",{className:"furatpay-payment-method-block"},(0,e.createElement)("p",null,(0,t.__)("No payment services available.","woo_furatpay"))):(0,e.createElement)("div",{className:"furatpay-payment-method-block"},(0,e.createElement)(s,{services:l,selectedService:c,onSelect:e=>{i(e);const t=l.find((t=>t.id===e));if(t)try{sessionStorage.setItem("furatpay_service_id",e.toString()),sessionStorage.setItem("furatpay_service_name",t.name)}catch(e){}}}))},o={name:r,label:(0,e.createElement)((()=>(0,e.createElement)("div",{className:"furatpay-block-label"},(0,e.createElement)("span",null,furatpayData.title),furatpayData.icon&&(0,e.createElement)("img",{src:furatpayData.icon,alt:"FuratPay",className:"furatpay-icon"}))),null),content:(0,e.createElement)(n,null),edit:(0,e.createElement)(n,null),canMakePayment:()=>!0,ariaLabel:(0,t.__)("FuratPay payment method","woo_furatpay"),supports:{features:furatpayData.supports||["products"],showSavedPaymentMethods:!1,showSaveOption:!1}},{registerPaymentMethod:c}=wc.wcBlocksRegistry;c(o),function(){const e=window.fetch;window.fetch=function(...t){const[a,r]=t;if(a&&"string"==typeof a&&a.includes("/wc/store/v1/checkout")){const e=sessionStorage.getItem("furatpay_service_id"),t=sessionStorage.getItem("furatpay_service_name");if(e&&r&&r.body)try{const a=JSON.parse(r.body);a.extensions||(a.extensions={}),a.extensions.furatpay={furatpay_service:e,furatpay_service_name:t||""},r.body=JSON.stringify(a)}catch(e){}}return e.apply(this,t)}}(),"undefined"!=typeof wp&&wp.data&&wp.data.select&&wp.domReady((()=>{try{const e=wp.data.select("wc/store/checkout");if(e){const t=e.getAvailablePaymentMethods();if(t&&t.includes(r)){const e=wp.data.dispatch("wc/store/payment");e&&e.setActivePaymentMethod&&e.setActivePaymentMethod(r)}}}catch(e){}}))})();