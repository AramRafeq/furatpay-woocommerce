(()=>{"use strict";const e=window.React,t=window.wp.i18n,a=window.wp.element,s="furatpay",n=({services:t,selectedService:a,onSelect:s})=>(0,e.createElement)("ul",{className:"furatpay-method-list"},t.map((t=>(0,e.createElement)("li",{key:t.id,className:"furatpay-method-item"},(0,e.createElement)("label",null,(0,e.createElement)("input",{type:"radio",name:"furatpay_service",value:t.id,checked:a===t.id,onChange:()=>s(t.id),required:"required",className:"furatpay-service-radio"}),t.logo&&(0,e.createElement)("img",{src:t.logo,alt:t.name,className:"furatpay-method-logo"}),(0,e.createElement)("span",{className:"furatpay-method-name"},t.name)))))),r=({eventRegistration:s,emitResponse:r,extensions:c})=>{const[o,i]=(0,a.useState)(null),[l,p]=(0,a.useState)([]),{onPaymentSetup:y}=s;return(0,a.useEffect)((()=>{let e=!0;return(async()=>{try{const t=await fetch(furatpayData.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"furatpay_get_payment_services",nonce:furatpayData.nonce})});if(!t.ok)throw new Error("Failed to fetch payment services");const a=await t.json();if(e&&a.success&&Array.isArray(a.data)&&(p(a.data),a.data.length>0&&!o)){const e=a.data[0].id,t=a.data[0].name;i(e);try{sessionStorage.setItem("furatpay_service_id",e.toString()),sessionStorage.setItem("furatpay_service_name",t)}catch(e){}}}catch(e){}})(),()=>{e=!1}}),[]),(0,a.useEffect)((()=>{const e=y((()=>{if(!o)return{type:r.responseTypes.ERROR,message:(0,t.__)("Please select a payment service.","woo_furatpay")};const e=l.find((e=>e.id===o));if(!e)return{type:r.responseTypes.ERROR,message:(0,t.__)("Invalid payment service selected.","woo_furatpay")};const a=[{key:"furatpay_service",value:o.toString()},{key:"furatpay_service_name",value:e.name}];return{type:r.responseTypes.SUCCESS,meta:{paymentMethodData:a},paymentMethodData:a}}));return()=>e()}),[y,o,l,r.responseTypes]),0===l.length?(0,e.createElement)("div",{className:"furatpay-payment-method-block"},(0,e.createElement)("p",null,(0,t.__)("No payment services available.","woo_furatpay"))):(0,e.createElement)("div",{className:"furatpay-payment-method-block"},(0,e.createElement)(n,{services:l,selectedService:o,onSelect:e=>{i(e);const t=l.find((t=>t.id===e));if(t)try{sessionStorage.setItem("furatpay_service_id",e.toString()),sessionStorage.setItem("furatpay_service_name",t.name)}catch(e){}}}))},c={name:s,label:(0,e.createElement)((()=>(0,e.createElement)("div",{className:"furatpay-block-label"},(0,e.createElement)("span",null,furatpayData.title),furatpayData.icon&&(0,e.createElement)("img",{src:furatpayData.icon,alt:"FuratPay",className:"furatpay-icon"}))),null),content:(0,e.createElement)(r,null),edit:(0,e.createElement)(r,null),canMakePayment:()=>!0,ariaLabel:(0,t.__)("FuratPay payment method","woo_furatpay"),supports:{features:furatpayData.supports||["products"],showSavedPaymentMethods:!1,showSaveOption:!1}},{registerPaymentMethod:o}=wc.wcBlocksRegistry;o(c),function(){const e=window.fetch;window.fetch=function(...t){const[a,s]=t;if(a&&"string"==typeof a&&a.includes("/wc/store/v1/checkout")){const e=sessionStorage.getItem("furatpay_service_id"),t=sessionStorage.getItem("furatpay_service_name");if(e&&s&&s.body)try{const a=JSON.parse(s.body);a.extensions||(a.extensions={}),a.extensions.furatpay={furatpay_service:e,furatpay_service_name:t||""},s.body=JSON.stringify(a)}catch(e){}}return e.apply(this,t)}}(),"undefined"!=typeof wp&&wp.data&&wp.data.select&&wp.domReady((()=>{try{const e=wp.data.select("wc/store/checkout");if(e){const t=e.getAvailablePaymentMethods();if(t&&t.includes(s)){const e=wp.data.dispatch("wc/store/payment");e&&e.setActivePaymentMethod&&e.setActivePaymentMethod(s)}}}catch(e){}}))})();